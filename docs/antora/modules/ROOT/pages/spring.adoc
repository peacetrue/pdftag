= spring

== 问题

=== ApplicationEventPublisher 不支持反应式编程

https://github.com/spring-projects/spring-framework/issues/21025

=== 在 Reactor 中异步执行

在 Reactor 中异步执行，直接调用 `subscribe` 方法，但此方法会阻塞线程， 尝试发布到一个自定义的调度器 `.publishOn(Schedulers.fromExecutorService(Executors.newFixedThreadPool(10)))` 无效，最终直接使用线程池调度。

在反应式编程中，涉及到 spring 接口代理的，都无法使用异步执行的模式。

[source%nowrap,java]
----
        return entityTemplate.insert(entity)
                .map(item -> BeanUtils.map(item, PhoneTagVO.class))
//                .doOnNext(item -> eventPublisher.publishEvent(new PayloadApplicationEvent<>(item, params)))
                .doOnNext(item -> {
                    executorService.execute(() -> {
                        DitaUtils.executePdf("/Users/xiayx/Documents/Projects/pdftag/docs/antora/modules/ROOT/attachment/dita-ot-2.3",
                                "Mi_giftBox_label_Cn/template-3a0b6976a1484e9da4d9c82c3cebb95a.dita",
                                "/Users/xiayx/Documents/Projects/pdftag/02-output/output",
                                "-Dargs.input.dir=/Users/xiayx/Documents/Projects/pdftag/02-output/2020/11/28/Mi_giftBox_label_Cn",
                                "-Dcustomization.dir=/Users/xiayx/Documents/Projects/learn-dita-ot/src/test/resources/watermark"
                        )
                                .subscribe(value -> System.out.println("-----------" + value));
                    });
                })
                ;

----

